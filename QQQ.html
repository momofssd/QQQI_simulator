<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QQQY DCA Simulator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        background: #f7f8f9;
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1600px;
        margin: 0 auto;
        background: white;
        border-radius: 4px;
        padding: 40px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      h1 {
        text-align: center;
        color: #00683d;
        margin-bottom: 10px;
        font-size: 2.5em;
        font-weight: 500;
      }

      .subtitle {
        text-align: center;
        color: #333;
        margin-bottom: 30px;
        font-size: 1em;
        font-weight: 400;
      }

      .input-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
        padding: 30px;
        background: #f7f8f9;
        border-radius: 4px;
        border: 1px solid #e3e4e6;
      }

      .input-group {
        display: flex;
        flex-direction: column;
      }

      label {
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
        font-size: 0.9em;
      }

      input,
      select {
        padding: 12px;
        border: 1px solid #c7c8ca;
        border-radius: 4px;
        font-size: 1em;
        transition: border-color 0.3s;
        background: white;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: #00683d;
        box-shadow: 0 0 0 2px rgba(0, 104, 61, 0.1);
      }

      .button-group {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-bottom: 30px;
      }

      button {
        padding: 15px 40px;
        font-size: 1em;
        font-weight: 600;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s;
        letter-spacing: 0.5px;
      }

      .btn-calculate {
        background: #00683d;
        color: white;
      }

      .btn-calculate:hover {
        background: #005231;
        box-shadow: 0 2px 8px rgba(0, 104, 61, 0.3);
      }

      .btn-reset {
        background: white;
        color: #333;
        border: 2px solid #c7c8ca;
      }

      .btn-reset:hover {
        border-color: #00683d;
        color: #00683d;
      }

      .results {
        display: none;
      }

      .results.show {
        display: block;
      }

      .summary-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
      }

      .card {
        background: white;
        padding: 15px 10px;
        border-radius: 4px;
        text-align: center;
        border: 1px solid #e3e4e6;
        transition: box-shadow 0.3s;
        min-height: 90px;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }

      .card-title {
        font-size: 0.75em;
        color: #666;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
        line-height: 1.3;
      }

      .card-value {
        font-size: 1.6em;
        font-weight: 600;
        color: #00683d;
        word-wrap: break-word;
        line-height: 1.2;
      }

      .card-value.small {
        font-size: 1.2em;
      }

      .card-value.xsmall {
        font-size: 1em;
      }

      .card-value.negative {
        color: #c8102e;
      }

      .chart-container {
        position: relative;
        height: 400px;
        margin-bottom: 30px;
        background: white;
        padding: 20px;
        border-radius: 4px;
        border: 1px solid #e3e4e6;
      }

      .year-table {
        overflow-x: auto;
        overflow-y: auto;
        max-height: 600px;
        margin-top: 20px;
        border: 1px solid #e3e4e6;
        border-radius: 4px;
        position: relative;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        background: white;
      }

      th {
        background: #00683d;
        color: white;
        padding: 15px 12px;
        text-align: left;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.8em;
        letter-spacing: 0.5px;
        position: sticky;
        top: 0;
        z-index: 10;
      }

      td {
        padding: 12px;
        border-bottom: 1px solid #e3e4e6;
        color: #333;
        font-size: 0.9em;
      }

      tr:last-child td {
        border-bottom: none;
      }

      tr:hover {
        background: #f7f8f9;
      }

      .highlight {
        background: #fff8dc !important;
        font-weight: 600;
      }

      .logo-header {
        text-align: center;
        margin-bottom: 20px;
        padding-bottom: 20px;
        border-bottom: 3px solid #00683d;
      }

      .logo-text {
        font-size: 1.2em;
        color: #00683d;
        font-weight: 700;
        letter-spacing: 2px;
      }

      @media (max-width: 768px) {
        .container {
          padding: 20px;
        }

        h1 {
          font-size: 1.8em;
        }

        .input-grid {
          grid-template-columns: 1fr;
          padding: 20px;
        }

        .button-group {
          flex-direction: column;
        }

        button {
          width: 100%;
        }

        th,
        td {
          font-size: 0.75em;
          padding: 8px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="logo-header">
        <div class="logo-text">INVESTMENT CALCULATOR</div>
      </div>
      <h1>QQQI DCA Simulator</h1>
      <p class="subtitle">
        Dividend Reinvestment Calculator with Market Volatility Analysis
      </p>
      <p
        class="subtitle"
        style="
          font-size: 0.85em;
          color: #666;
          margin-top: -20px;
          line-height: 1.5;
        "
      >
        QQQI ROC Tax Treatment: ROC reduces cost basis (tax-deferred) until each
        lot reaches $0. Once depleted, additional ROC becomes taxable capital
        gain with Section 1256 treatment (60% long-term, 40% short-term).
        Default ROC: 14% annually. Set your own sell age for projection end.
      </p>

      <div class="input-grid">
        <div class="input-group">
          <label for="initialBalance">Initial Investment ($)</label>
          <input
            type="number"
            id="initialBalance"
            value="10000"
            min="0"
            step="100"
          />
        </div>

        <div class="input-group">
          <label for="qqqiPrice">Current QQQI Price ($)</label>
          <input
            type="number"
            id="qqqiPrice"
            value="50"
            min="0.01"
            step="0.01"
          />
        </div>

        <div class="input-group">
          <label for="monthlyDcaAmount">Monthly DCA Amount ($)</label>
          <input
            type="number"
            id="monthlyDcaAmount"
            value="400"
            min="0"
            step="10"
          />
        </div>

        <div class="input-group">
          <label for="currentAge">Current Age</label>
          <input
            type="number"
            id="currentAge"
            value="30"
            min="18"
            max="100"
            step="1"
          />
        </div>

        <div class="input-group">
          <label for="targetAge">Target Age (Stop DCA & Reinvestment)</label>
          <input
            type="number"
            id="targetAge"
            value="65"
            min="18"
            max="120"
            step="1"
          />
        </div>

        <div class="input-group">
          <label for="sellAge">Sell Age (Cash Out & End Projection)</label>
          <input
            type="number"
            id="sellAge"
            value="85"
            min="18"
            max="120"
            step="1"
          />
        </div>

        <div class="input-group">
          <label for="annualROC">Annual ROC Rate (%)</label>
          <input
            type="number"
            id="annualROC"
            value="14"
            min="0"
            max="100"
            step="0.5"
          />
        </div>

        <div class="input-group">
          <label for="marketTrend">Market Trend</label>
          <select id="marketTrend">
            <option value="neutral">Neutral</option>
            <option value="random">Random (Bullish/Bearish)</option>
            <option value="bullish">Bullish Bias</option>
            <option value="bearish">Bearish Bias</option>
          </select>
        </div>
      </div>

      <div class="button-group">
        <button class="btn-calculate" onclick="calculate()">Calculate</button>
        <button class="btn-reset" onclick="reset()">Reset</button>
      </div>

      <div class="results" id="results">
        <div class="summary-cards">
          <div class="card">
            <div class="card-title">Total Principal</div>
            <div class="card-value" id="totalPrincipal">$0</div>
          </div>
          <div class="card">
            <div class="card-title">Total Invested</div>
            <div class="card-value" id="totalInvested">$0</div>
          </div>
          <div class="card">
            <div class="card-title">Final Balance</div>
            <div class="card-value" id="finalBalance">$0</div>
          </div>
          <div class="card">
            <div class="card-title">Total ROC Received</div>
            <div class="card-value" id="totalROC">$0</div>
          </div>
          <div class="card">
            <div class="card-title">Latest Monthly ROC</div>
            <div class="card-value" id="latestMonthlyROC">$0</div>
          </div>
          <div class="card">
            <div class="card-title">Tax Deferred</div>
            <div class="card-value" id="totalTaxDeferred">$0</div>
          </div>
          <div class="card">
            <div class="card-title">Tax on ROC</div>
            <div class="card-value" id="totalROCTaxesPaid">$0</div>
          </div>
          <div class="card">
            <div class="card-title">Tax on Sale</div>
            <div class="card-value" id="capitalGainsTax">$0</div>
          </div>
          <div class="card">
            <div class="card-title">Total Taxes Paid</div>
            <div class="card-value" id="totalTaxesPaid">$0</div>
          </div>
          <div class="card">
            <div class="card-title">Final Cost Basis</div>
            <div class="card-value" id="finalCostBasis">$0</div>
          </div>
          <div class="card">
            <div class="card-title">Target Year</div>
            <div class="card-value" id="targetYearDisplay">0</div>
          </div>
        </div>

        <div class="chart-container">
          <canvas id="rocChart"></canvas>
        </div>

        <div class="year-table">
          <table>
            <thead>
              <tr>
                <th>Month</th>
                <th>Year</th>
                <th>Age</th>
                <th>Shares</th>
                <th>Share Price</th>
                <th>Total Invested</th>
                <th>Total Balance</th>
                <th>Monthly ROC</th>
                <th>ROC Reinvested</th>
                <th>Tax Deferred</th>
                <th>Tax Paid</th>
                <th>Cost Basis</th>
                <th>Market Trend</th>
              </tr>
            </thead>
            <tbody id="yearTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <script>
      let rocChart = null;

      function formatCurrency(value) {
        return new Intl.NumberFormat("en-US", {
          style: "currency",
          currency: "USD",
          minimumFractionDigits: 0,
          maximumFractionDigits: 0,
        }).format(value);
      }

      function setCardValue(elementId, value) {
        const element = document.getElementById(elementId);
        const formattedValue = formatCurrency(value);
        element.textContent = formattedValue;

        // Dynamically adjust font size based on length
        element.classList.remove("small", "xsmall");
        if (formattedValue.length > 11) {
          element.classList.add("xsmall");
        } else if (formattedValue.length > 8) {
          element.classList.add("small");
        }
      }

      function generateMarketTrends(years, trendType) {
        const trends = [];
        for (let i = 0; i < years; i++) {
          let volatility;
          if (trendType === "random") {
            // Random selection between bullish and bearish
            volatility =
              Math.random() > 0.5
                ? Math.random() * 0.03 // Bullish: 0% to 3%
                : -(Math.random() * 0.03); // Bearish: 0% to -3%
          } else if (trendType === "bullish") {
            volatility = Math.random() * 0.03; // 0% to 3%
          } else if (trendType === "bearish") {
            volatility = -(Math.random() * 0.03); // 0% to -3%
          } else {
            volatility = 0;
          }
          trends.push(volatility);
        }
        return trends;
      }

      function calculate() {
        const initialBalance = parseFloat(
          document.getElementById("initialBalance").value,
        );
        const qqqiPrice = parseFloat(
          document.getElementById("qqqiPrice").value,
        );
        const monthlyDcaAmount = parseFloat(
          document.getElementById("monthlyDcaAmount").value,
        );
        const currentAge = parseInt(
          document.getElementById("currentAge").value,
        );
        const targetAge = parseInt(document.getElementById("targetAge").value);
        const sellAge = parseInt(document.getElementById("sellAge").value);
        const annualROC = parseFloat(
          document.getElementById("annualROC").value,
        );
        const marketTrend = document.getElementById("marketTrend").value;

        if (targetAge <= currentAge) {
          alert("Target age must be greater than current age");
          return;
        }

        if (sellAge < targetAge) {
          alert("Sell age must be greater than or equal to target age");
          return;
        }

        const currentYear = new Date().getFullYear();
        const currentMonth = new Date().getMonth() + 1;

        // Calculate projection periods
        const yearsToDCAStop = targetAge - currentAge;
        const totalProjectionYears = sellAge - currentAge; // Project to sell age
        const totalMonths = totalProjectionYears * 12;

        // Convert annual ROC to monthly rate
        const baseMonthlyROC = annualROC / 100 / 12;

        // Generate market trends
        const yearlyTrends = generateMarketTrends(
          totalProjectionYears,
          marketTrend,
        );

        // Initialize share tracking
        let totalShares = initialBalance / qqqiPrice;
        let currentSharePrice = qqqiPrice;
        let totalInvested = initialBalance;
        let totalROCReceived = 0;
        let totalROCReinvested = 0;
        let totalTaxDeferred = 0;
        let totalTaxesPaid = 0;

        // Track investment lots with FIFO (First In First Out)
        const investmentLots = [
          {
            shares: totalShares,
            costBasisPerShare: qqqiPrice,
            totalCostBasis: initialBalance,
            monthAdded: 0,
          },
        ];

        const monthlyData = [];
        const chartData = [];

        let yearlyAggregate = {
          year: currentYear,
          endBalance: 0,
          rocReceived: 0,
        };

        // Simulate month by month
        for (let month = 0; month < totalMonths; month++) {
          const yearIndex = Math.floor(month / 12);
          const monthInYear = ((currentMonth + month - 1) % 12) + 1;
          const year =
            currentYear + Math.floor((currentMonth + month - 1) / 12);
          const age = currentAge + yearIndex;

          // Update share price based on market trend (monthly volatility)
          const monthlyVolatility = yearlyTrends[yearIndex] / 12;
          currentSharePrice = currentSharePrice * (1 + monthlyVolatility);

          // Add Monthly DCA only until target age
          if (age < targetAge) {
            const sharesAdded = monthlyDcaAmount / currentSharePrice;
            totalShares += sharesAdded;
            totalInvested += monthlyDcaAmount;

            // Add new investment lot
            investmentLots.push({
              shares: sharesAdded,
              costBasisPerShare: currentSharePrice,
              totalCostBasis: monthlyDcaAmount,
              monthAdded: month,
            });
          }

          // Calculate monthly ROC distribution - ALWAYS PAID regardless of age
          const balance = totalShares * currentSharePrice;
          const rocAmount = balance * baseMonthlyROC;
          const rocPerShare = rocAmount / totalShares;
          totalROCReceived += rocAmount;

          let rocReinvested = 0;
          let taxDeferred = 0;
          let taxesPaid = 0;

          // Reinvest ROC only until target age
          if (age < targetAge) {
            const sharesFromROC = rocAmount / currentSharePrice;
            totalShares += sharesFromROC;
            rocReinvested = rocAmount;
            totalROCReinvested += rocAmount;

            // When reinvesting, create new lot with current share price as cost basis
            investmentLots.push({
              shares: sharesFromROC,
              costBasisPerShare: currentSharePrice,
              totalCostBasis: rocAmount,
              monthAdded: month,
            });
          }

          // Process ROC against ALL shares for tax calculation (FIFO basis)
          // Each share receives rocPerShare in ROC distribution
          for (let i = 0; i < investmentLots.length; i++) {
            const lot = investmentLots[i];
            const lotROC = rocPerShare * lot.shares;

            if (lot.costBasisPerShare > 0) {
              // ROC reduces cost basis per share
              const basisReductionPerShare = Math.min(
                rocPerShare,
                lot.costBasisPerShare,
              );
              lot.costBasisPerShare -= basisReductionPerShare;
              lot.totalCostBasis = lot.shares * lot.costBasisPerShare;

              const taxDeferredForLot = basisReductionPerShare * lot.shares;
              taxDeferred += taxDeferredForLot;

              // If this lot's cost basis is now zero, any remaining ROC to this lot is taxable
              if (
                lot.costBasisPerShare === 0 &&
                rocPerShare > basisReductionPerShare
              ) {
                const excessROCPerShare = rocPerShare - basisReductionPerShare;
                const taxableGain = excessROCPerShare * lot.shares;

                // Section 1256 treatment: 60% long-term (15%), 40% short-term (24%)
                const longTermRate = 0.15;
                const shortTermRate = 0.24;
                const blendedRate = 0.6 * longTermRate + 0.4 * shortTermRate;

                taxesPaid += taxableGain * blendedRate;
              }
            } else {
              // Cost basis already at zero - all ROC for this lot is taxable
              const taxableGain = lotROC;

              // Section 1256 treatment: 60% long-term (15%), 40% short-term (24%)
              const longTermRate = 0.15;
              const shortTermRate = 0.24;
              const blendedRate = 0.6 * longTermRate + 0.4 * shortTermRate;

              taxesPaid += taxableGain * blendedRate;
            }
          }

          totalTaxDeferred += taxDeferred;
          totalTaxesPaid += taxesPaid;

          // Calculate total remaining cost basis
          const totalCostBasis = investmentLots.reduce(
            (sum, lot) => sum + lot.totalCostBasis,
            0,
          );

          monthlyData.push({
            month: monthInYear,
            year: year,
            age: age,
            shares: totalShares,
            sharePrice: currentSharePrice,
            totalInvested: totalInvested,
            balance: balance,
            monthlyROC: rocAmount,
            rocReinvested: rocReinvested,
            taxDeferred: taxDeferred,
            taxesPaid: taxesPaid,
            costBasis: totalCostBasis,
            trend: yearlyTrends[yearIndex],
          });

          // Aggregate for chart (yearly basis)
          yearlyAggregate.endBalance = balance;
          yearlyAggregate.rocReceived += rocAmount;

          if ((month + 1) % 12 === 0 || month === totalMonths - 1) {
            chartData.push({
              year: year,
              endBalance: yearlyAggregate.endBalance,
              rocReceived: yearlyAggregate.rocReceived,
            });
            yearlyAggregate = {
              year: year + 1,
              endBalance: 0,
              rocReceived: 0,
            };
          }
        }

        const finalBalance = totalShares * currentSharePrice;
        const finalCostBasis = investmentLots.reduce(
          (sum, lot) => sum + lot.totalCostBasis,
          0,
        );
        const targetYearCalc = currentYear + yearsToDCAStop;
        const latestMonthlyROC =
          monthlyData.length > 0
            ? monthlyData[monthlyData.length - 1].monthlyROC
            : 0;

        // Use the sum of monthly data for Total ROC Received to ensure absolute consistency
        const totalROC = monthlyData.reduce(
          (sum, data) => sum + data.monthlyROC,
          0,
        );

        // Calculate capital gains tax on selling all shares
        const capitalGain = finalBalance - finalCostBasis; // Sale proceeds minus adjusted cost basis
        const longTermCapitalGainsRate = 0.2; // 20% for high earners (can be 15% or 0% based on income)
        const capitalGainsTax =
          capitalGain > 0 ? capitalGain * longTermCapitalGainsRate : 0;

        // Add capital gains tax to the last month's tax
        if (monthlyData.length > 0) {
          monthlyData[monthlyData.length - 1].taxesPaid += capitalGainsTax;
          monthlyData[monthlyData.length - 1].capitalGainsTax = capitalGainsTax;
        }

        const totalAllTaxes = totalTaxesPaid + capitalGainsTax;

        // Display results with dynamic font sizing
        setCardValue("totalPrincipal", totalInvested);
        setCardValue("totalInvested", totalInvested);
        setCardValue("finalBalance", finalBalance);
        setCardValue("totalROC", totalROC);
        setCardValue("latestMonthlyROC", latestMonthlyROC);
        setCardValue("totalTaxDeferred", totalTaxDeferred);
        setCardValue("totalROCTaxesPaid", totalTaxesPaid);
        setCardValue("capitalGainsTax", capitalGainsTax);
        setCardValue("totalTaxesPaid", totalAllTaxes);
        setCardValue("finalCostBasis", finalCostBasis);

        document.getElementById("targetYearDisplay").textContent =
          targetYearCalc;

        // Update table
        const tbody = document.getElementById("yearTableBody");
        tbody.innerHTML = "";
        monthlyData.forEach((data, index) => {
          const row = tbody.insertRow();
          const isLastRow = index === monthlyData.length - 1;

          if (data.age === targetAge && data.month === 12) {
            row.classList.add("highlight");
          }
          if (data.age === sellAge && data.month === 12) {
            row.style.backgroundColor = "#e8f5e9";
            row.style.borderLeft = "3px solid #00683d";
            row.style.fontWeight = "bold";
          }
          const monthNames = [
            "Jan",
            "Feb",
            "Mar",
            "Apr",
            "May",
            "Jun",
            "Jul",
            "Aug",
            "Sep",
            "Oct",
            "Nov",
            "Dec",
          ];

          // Highlight rows where taxes were paid
          if (data.taxesPaid > 0 && data.age !== sellAge) {
            row.style.backgroundColor = "#fff5f5";
            row.style.borderLeft = "3px solid #c8102e";
          }

          // Format tax paid cell - show breakdown for last row
          let taxPaidCell = "";
          if (isLastRow && data.capitalGainsTax) {
            const rocTax = data.taxesPaid - data.capitalGainsTax;
            taxPaidCell = `<strong style="color: #c8102e;">${formatCurrency(data.taxesPaid)}</strong><br><small style="color: #666;">(ROC: ${formatCurrency(rocTax)}<br>Sale: ${formatCurrency(data.capitalGainsTax)})</small>`;
          } else if (data.taxesPaid > 0) {
            taxPaidCell = `<strong style="color: #c8102e;">${formatCurrency(data.taxesPaid)}</strong>`;
          } else {
            taxPaidCell = formatCurrency(data.taxesPaid);
          }

          row.innerHTML = `
                    <td>${monthNames[data.month - 1]}</td>
                    <td>${data.year}</td>
                    <td>${data.age}</td>
                    <td>${data.shares.toFixed(2)}</td>
                    <td>$${data.sharePrice.toFixed(2)}</td>
                    <td>${formatCurrency(data.totalInvested)}</td>
                    <td>${formatCurrency(data.balance)}</td>
                    <td>${formatCurrency(data.monthlyROC)}</td>
                    <td>${formatCurrency(data.rocReinvested)}</td>
                    <td>${formatCurrency(data.taxDeferred)}</td>
                    <td>${taxPaidCell}</td>
                    <td>${formatCurrency(data.costBasis)}</td>
                    <td>${data.trend >= 0 ? "+" : ""}${(data.trend * 100).toFixed(2)}%</td>
                `;
        });

        // Update chart with yearly data
        updateChart(chartData);

        // Show results
        document.getElementById("results").classList.add("show");
        document
          .getElementById("results")
          .scrollIntoView({ behavior: "smooth", block: "nearest" });
      }

      function updateChart(yearlyData) {
        const ctx = document.getElementById("rocChart").getContext("2d");

        if (rocChart) {
          rocChart.destroy();
        }

        rocChart = new Chart(ctx, {
          type: "line",
          data: {
            labels: yearlyData.map((d) => d.year),
            datasets: [
              {
                label: "Total Balance",
                data: yearlyData.map((d) => d.endBalance),
                borderColor: "#00683d",
                backgroundColor: "rgba(0, 104, 61, 0.1)",
                borderWidth: 3,
                tension: 0.4,
                fill: true,
              },
              {
                label: "Annual ROC",
                data: yearlyData.map((d) => d.rocReceived),
                borderColor: "#6cae4f",
                backgroundColor: "rgba(108, 174, 79, 0.1)",
                borderWidth: 2,
                tension: 0.4,
                fill: true,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: true,
                position: "top",
                labels: {
                  font: {
                    size: 13,
                    weight: "600",
                    family: "'Helvetica Neue', Helvetica, Arial, sans-serif",
                  },
                  padding: 15,
                  color: "#333",
                },
              },
              tooltip: {
                mode: "index",
                intersect: false,
                backgroundColor: "rgba(0, 0, 0, 0.8)",
                titleFont: {
                  size: 14,
                  weight: "600",
                },
                bodyFont: {
                  size: 13,
                },
                padding: 12,
                callbacks: {
                  label: function (context) {
                    let label = context.dataset.label || "";
                    if (label) {
                      label += ": ";
                    }
                    label += formatCurrency(context.parsed.y);
                    return label;
                  },
                },
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function (value) {
                    return formatCurrency(value);
                  },
                  font: {
                    size: 11,
                  },
                  color: "#666",
                },
                grid: {
                  color: "rgba(0, 0, 0, 0.06)",
                  drawBorder: false,
                },
              },
              x: {
                ticks: {
                  font: {
                    size: 11,
                  },
                  maxRotation: 45,
                  minRotation: 45,
                  color: "#666",
                },
                grid: {
                  display: false,
                },
              },
            },
          },
        });
      }

      function reset() {
        document.getElementById("initialBalance").value = "10000";
        document.getElementById("qqqiPrice").value = "50";
        document.getElementById("monthlyDcaAmount").value = "400";
        document.getElementById("currentAge").value = "30";
        document.getElementById("targetAge").value = "65";
        document.getElementById("sellAge").value = "85";
        document.getElementById("annualROC").value = "14";
        document.getElementById("marketTrend").value = "neutral";
        document.getElementById("results").classList.remove("show");

        if (rocChart) {
          rocChart.destroy();
          rocChart = null;
        }
      }
    </script>
  </body>
</html>
